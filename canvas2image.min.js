var Canvas2Image=function(){var t,r,a=(t=document.createElement("canvas"),{canvas:!!(r=t.getContext("2d")),imageData:!!r.getImageData,dataURL:!!t.toDataURL,btoa:!!window.btoa});function n(t,r,a){var n=t.width,e=t.height;null==r&&(r=n),null==a&&(a=e);var o=document.createElement("canvas"),u=o.getContext("2d");return o.width=r,o.height=a,u.drawImage(t,0,0,n,e,0,0,r,a),o}function e(t,r,a,e){return(t=n(t,a,e)).toDataURL(r)}function o(t){document.location.href=t}function u(t){var r=document.createElement("img");return r.src=t,r}function h(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function s(t){if(!window.btoa)throw"btoa undefined";var r="";if("string"==typeof t)r=t;else for(var a=0;a<t.length;a++)r+=String.fromCharCode(t[a]);return btoa(r)}function p(t){var r=t.width,a=t.height;return t.getContext("2d").getImageData(0,0,r,a)}function i(t,r){return"data:"+r+";base64,"+t}var f=function(t){var r=[],a=[],n=t.width,e=t.height;r.push(66),r.push(77);var o=n*e*3+54;r.push(o%256),o=Math.floor(o/256),r.push(o%256),o=Math.floor(o/256),r.push(o%256),o=Math.floor(o/256),r.push(o%256),r.push(0),r.push(0),r.push(0),r.push(0),r.push(54),r.push(0),r.push(0),r.push(0),a.push(40),a.push(0),a.push(0),a.push(0);var u=n;a.push(u%256),u=Math.floor(u/256),a.push(u%256),u=Math.floor(u/256),a.push(u%256),u=Math.floor(u/256),a.push(u%256);var h=e;a.push(h%256),h=Math.floor(h/256),a.push(h%256),h=Math.floor(h/256),a.push(h%256),h=Math.floor(h/256),a.push(h%256),a.push(1),a.push(0),a.push(24),a.push(0),a.push(0),a.push(0),a.push(0),a.push(0);var p=n*e*3;a.push(p%256),p=Math.floor(p/256),a.push(p%256),p=Math.floor(p/256),a.push(p%256),p=Math.floor(p/256),a.push(p%256);for(var i=0;i<16;i++)a.push(0);var f=(4-3*n%4)%4,c=t.data,g="",v=e;do{for(var m=n*(v-1)*4,l="",d=0;d<n;d++){var C=4*d;l+=String.fromCharCode(c[m+C+2]),l+=String.fromCharCode(c[m+C+1]),l+=String.fromCharCode(c[m+C])}for(var M=0;M<f;M++)l+=String.fromCharCode(0);g+=l}while(--v);return s(r.concat(a))+s(g)},c=function(t,r,u,s){if(a.canvas&&a.dataURL)if(null==s&&(s="png"),s=h(s),/bmp/.test(s)){var c=p(n(t,r,u));o(i(f(c),"image/octet-stream"))}else{o(e(t,s,r,u).replace(s,"image/octet-stream"))}},g=function(t,r,o,s){if(a.canvas&&a.dataURL){if(null==s&&(s="png"),s=h(s),/bmp/.test(s)){var c=p(n(t,r,o));return u(i(f(c),"image/bmp"))}return u(e(t,s,r,o))}};return{saveAsImage:c,saveAsPNG:function(t,r,a){return c(t,r,a,"png")},saveAsJPEG:function(t,r,a){return c(t,r,a,"jpeg")},saveAsGIF:function(t,r,a){return c(t,r,a,"gif")},saveAsBMP:function(t,r,a){return c(t,r,a,"bmp")},convertToImage:g,convertToPNG:function(t,r,a){return g(t,r,a,"png")},convertToJPEG:function(t,r,a){return g(t,r,a,"jpeg")},convertToGIF:function(t,r,a){return g(t,r,a,"gif")},convertToBMP:function(t,r,a){return g(t,r,a,"bmp")}}}();